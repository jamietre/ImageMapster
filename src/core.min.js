/* ImageMapster
   Version: see $.mapster.version

Copyright 2011 James Treworgy
http://www.outsharked.com/imagemapster
https://github.com/jamietre/ImageMapster

A jQuery plugin to enhance image maps.
*/
(function(a){a.fn.mapster=function(d){var c=a.mapster.impl;if(a.isFunction(c[d])){return c[d].apply(this,Array.prototype.slice.call(arguments,1));
}else{if(typeof d==="object"||!d){return c.bind.apply(this,arguments);}else{a.error("Method "+d+" does not exist on jQuery.mapster");
}}};a.mapster={version:"1.2.4.066",render_defaults:{isSelectable:true,isDeselectable:true,fade:false,fadeDuration:150,altImage:null,fill:true,fillColor:"000000",fillColorMask:"FFFFFF",fillOpacity:0.7,highlight:null,stroke:false,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,includeKeys:"",alt_image:null},defaults:{clickNavigate:false,wrapClass:null,wrapCss:null,onGetList:null,sortList:false,listenToList:false,mapKey:"",mapValue:"",singleSelect:false,listKey:"value",listSelectedAttribute:"selected",listSelectedClass:null,onClick:null,onMouseover:null,onMouseout:null,mouseoutDelay:0,onStateChange:null,boundList:null,onConfigured:null,configTimeout:30000,noHrefIsMask:true,scaleMap:true,safeLoad:false,areas:[]},shared_defaults:{render_highlight:{fade:true},render_select:{fade:false},staticState:null,selected:null},area_defaults:{includeKeys:"",isMask:false},canvas_style:{position:"absolute",left:0,top:0,padding:0,border:0},hasCanvas:null,isTouch:null,windowLoaded:false,map_cache:[],hooks:{},addHook:function(d,c){this.hooks[d]=(this.hooks[d]||[]).push(c);
},callHooks:function(d,c){a.each(this.hooks[d]||[],function(g,f){f.apply(c);});},utils:{subclass:function(c,d){var e=function(){var g=this,f=Array.prototype.slice.call(arguments,0);
g.base=c.prototype;g.base.init=function(){c.prototype.constructor.apply(g,f);};d.apply(g,f);
};e.prototype=new c();e.prototype.constructor=e;return e;},asArray:function(c){return c.constructor===Array?c:this.split(c);
},split:function(g,d){var f,e,c=g.split(",");for(f=0;f<c.length;f++){e=a.trim(c[f]);
if(e===""){c.splice(f,1);}else{c[f]=d?d(e):e;}}return c;},updateProps:function(c,d){var e,f=c||{},g=a.isEmptyObject(f)?d:c;
e=[];a.each(g,function(h){e.push(h);});a.each(Array.prototype.slice.call(arguments,1),function(h,j){a.each(j||{},function(k){if(!e||a.inArray(k,e)>=0){var i=j[k];
if(a.isPlainObject(i)){f[k]=a.extend(f[k]||{},i);}else{if(i&&i.constructor===Array){f[k]=i.slice(0);
}else{if(typeof i!=="undefined"){f[k]=j[k];}}}}});});return f;},isElement:function(c){return(typeof HTMLElement==="object"?c instanceof HTMLElement:c&&typeof c==="object"&&c.nodeType===1&&typeof c.nodeName==="string");
},indexOfProp:function(c,d,f){var e=c.constructor===Array?-1:null;a.each(c,function(h,g){if(g&&(d?g[d]:g)===f){e=h;
return false;}});return e;},boolOrDefault:function(d,c){return this.isBool(d)?d:c||false;
},isBool:function(c){return typeof c==="boolean";},ifFunction:function(d,e,c){if(a.isFunction(d)){d.call(e,c);
}},size:function(c){var d=a.mapster.utils;return{width:d.imgWidth(c,true),height:d.imgHeight(c,true),complete:function(){return !!this.height&&!!this.width;
}};},setOpacity:function(c,d){c.style.opacity=d;},fader:(function(){var c={},e=0,d=function(g,k,h,f){var i,j,l=a.mapster.utils;
if(typeof g==="number"){j=c[g];if(!j){return;}}else{i=l.indexOfProp(c,null,g);if(i){delete c[i];
}c[++e]=j=g;g=e;}h=h||1;k=(k+(h/10)>h-0.01)?h:k+(h/10);l.setOpacity(j,k);if(k<h){setTimeout(function(){d(g,k,h,f);
},f?f/10:15);}};return d;}())},getBoundList:function(g,e){if(!g.boundList){return null;
}var c,d,h=a(),f=a.mapster.utils.split(e);g.boundList.each(function(k,j){for(c=0;
c<f.length;c++){d=f[c];if(a(j).is("["+g.listKey+'="'+d+'"]')){h=h.add(j);}}});return h;
},setBoundListProperties:function(c,e,d){e.each(function(g,f){if(c.listSelectedClass){if(d){a(f).addClass(c.listSelectedClass);
}else{a(f).removeClass(c.listSelectedClass);}}if(c.listSelectedAttribute){a(f).attr(c.listSelectedAttribute,d);
}});},getMapDataIndex:function(e){var d,c;switch(e.tagName&&e.tagName.toLowerCase()){case"area":c=a(e).parent().attr("name");
d=a("img[usemap='#"+c+"']")[0];break;case"img":d=e;break;}return d?this.utils.indexOfProp(this.map_cache,"image",d):-1;
},getMapData:function(d){var c=this.getMapDataIndex(d.length?d[0]:d);if(c>=0){return c>=0?this.map_cache[c]:null;
}},queueCommand:function(e,f,d,c){if(!e){return false;}if(!e.complete||e.currentAction){e.commands.push({that:f,command:d,args:c});
return true;}return false;},unload:function(){this.impl.unload();this.utils=null;
this.impl=null;a.fn.mapster=null;a.mapster=null;a("*").unbind();}};var b=a.mapster;
a.each(["width","height"],function(f,d){var c=d.substr(0,1).toUpperCase()+d.substr(1);
b.utils["img"+c]=function(e,g){return(g?a(e)[d]():0)||e[d]||e["natural"+c]||e["client"+c]||e["offset"+c];
};});b.Method=function(g,d,c,f){var e=this;e.name=f.name;e.output=g;e.input=g;e.first=f.first||false;
e.args=f.args?Array.prototype.slice.call(f.args,0):[];e.key=f.key;e.func_map=d;e.func_area=c;
e.name=f.name;e.allowAsync=f.allowAsync||false;};b.Method.prototype.go=function(){var f,e,c,g,j,k=this.input,d=[],h=this;
g=k.length;for(f=0;f<g;f++){e=a.mapster.getMapData(k[f]);if(e){if(!h.allowAsync&&b.queueCommand(e,h.input,h.name,h.args)){if(this.first){j="";
}continue;}c=e.getData(k[f].nodeName==="AREA"?k[f]:this.key);if(c){if(a.inArray(c,d)<0){d.push(c);
}}else{j=this.func_map.apply(e,h.args);}if(this.first||typeof j!=="undefined"){break;
}}}a(d).each(function(m,l){j=h.func_area.apply(l,h.args);});if(typeof j!=="undefined"){return j;
}else{return this.output;}};a.mapster.impl=(function(){var e={},d=a.mapster,i=a.mapster.utils,h,c;
c=function(j){return d.map_cache.push(j)-1;};h=function(k){d.map_cache.splice(k.index,1);
for(var j=d.map_cache.length-1;j>=this.index;j--){d.map_cache[j].index--;}};function f(n,k){var j,l,m=n.options.areas;
if(k){a.each(k,function(p,o){l=i.indexOfProp(m,"key",this.key);if(l>=0){a.extend(m[l],this);
}else{m.push(this);}j=n.getDataForKey(this.key);if(j){a.extend(j.options,this);}});
}}function g(j,k){var l=i.updateProps({},k);delete l.areas;i.updateProps(j.options,l);
f(j,k.areas);i.updateProps(j.area_options,j.options);}e.get=function(j){var k=d.getMapData(this);
if(!(k&&k.complete)){throw ("Can't access data until binding complete.");}return(new d.Method(this,function(){return this.getSelected();
},function(){return this.isSelected();},{name:"get",args:arguments,key:j,first:true,allowAsync:true,defaultReturn:""})).go();
};e.data=function(j){return(new d.Method(this,null,function(){return this;},{name:"data",args:arguments,key:j})).go();
};e.highlight=function(j){return(new d.Method(this,function(){if(j===false){this.ensureNoHighlight();
}else{var k=this.highlightId;return k>=0?this.data[k].key:null;}},function(){this.highlight();
},{name:"highlight",args:arguments,key:j,first:true})).go();};e.keys=function(l,k){var m=[],n=d.getMapData(this);
if(!(n&&n.complete)){throw ("Can't access data until binding complete.");}function j(o){var p,q=[];
if(!k){q.push(o.key);}else{p=o.areas();a.each(p,function(s,r){q=q.concat(r.keys);
});}a.each(q,function(s,r){if(a.inArray(r,m)<0){m.push(r);}});}if(!(n&&n.complete)){return"";
}if(typeof l==="string"){if(k){j(n.getDataForKey(l));}else{m=[n.getKeysForGroup(l)];
}}else{k=l;this.each(function(p,o){if(o.nodeName==="AREA"){j(n.getDataForArea(o));
}});}return m.join(",");};e.select=function(){e.set.call(this,true);};e.deselect=function(){e.set.call(this,false);
};e.set=function(s,m,q){var o,p,r=q,n,k;function t(u){if(u){switch(s){case true:u.addSelection(r);
break;case false:u.removeSelection(true);break;default:u.toggleSelection(r);break;
}}}function j(u){if(u&&a.inArray(u,k)<0){k.push(u);n+=(n===""?"":",")+u.key;}}function l(u){a.each(k,function(w,v){t(v);
});if(!s){u.removeSelectionFinish();}if(u.options.boundList){d.setBoundListProperties(u.options,d.getBoundList(u.options,n),s);
}}this.filter("img,area").each(function(v,u){var w;p=d.getMapData(u);if(p!==o){if(o){l(o);
}k=[];n="";}if(p){w="";if(u.nodeName.toUpperCase()==="IMG"){if(!d.queueCommand(p,a(u),"set",[s,m,r])){if(m instanceof Array){if(m.length){w=m.join(",");
}}else{w=m;}if(w){a.each(i.split(w),function(x,y){j(p.getDataForKey(y.toString()));
o=p;});}}}else{r=m;if(!d.queueCommand(p,a(u),"set",[s,r])){j(p.getDataForArea(u));
o=p;}}}});if(p){l(p);}return this;};e.unbind=function(j){return(new d.Method(this,function(){this.clearEvents();
this.clearMapData(j);h(this);},null,{name:"unbind",args:arguments})).go();};e.rebind=function(j){return(new d.Method(this,function(){var k=this;
k.complete=false;k.configureOptions(j);k.bindImages(true,function(){k.buildDataset(true);
k.complete=true;});},null,{name:"rebind",args:arguments})).go();};e.get_options=function(l,k){var j=i.isBool(l)?l:k;
return(new d.Method(this,function(){var m=a.extend({},this.options);if(j){m.render_select=i.updateProps({},d.render_defaults,m,m.render_select);
m.render_highlight=i.updateProps({},d.render_defaults,m,m.render_highlight);}return m;
},function(){return j?this.effectiveOptions():this.options;},{name:"get_options",args:arguments,first:true,allowAsync:true,key:l})).go();
};e.set_options=function(j){return(new d.Method(this,function(){g(this,j);},null,{name:"set_options",args:arguments})).go();
};e.unload=function(){var j;for(j=d.map_cache.length-1;j>=0;j--){if(d.map_cache[j]){e.unbind.call(a(d.map_cache[j].image));
}}e.graphics=null;};e.snapshot=function(){return(new d.Method(this,function(){a.each(this.data,function(k,j){j.selected=false;
});this.base_canvas=this.graphics.createVisibleCanvas(this);a(this.image).before(this.base_canvas);
},null,{name:"snapshot"})).go();};e.state=function(){var j,k=null;a(this).each(function(m,l){if(l.nodeName==="IMG"){j=d.getMapData(l);
if(j){k=j.state();}return false;}});return k;};e.bind=function(j){return this.each(function(l,k){var m,n,p,o;
m=a(k);m.css("border",0);o=d.getMapData(k);if(o){e.unbind.apply(m);if(!o.complete){m.bind();
return true;}o=null;}p=this.getAttribute("usemap");n=p&&a('map[name="'+p.substr(1)+'"]');
if(!(m.is("img")&&p&&n.size()>0)){return true;}if(!o){o=new d.MapData(this,j);o.index=c(o);
o.map=n;o.bindImages(true);}});};e.init=function(l){var k,j;d.hasCanvas=(document.namespaces&&document.namespaces.g_vml_)?false:a("<canvas></canvas>")[0].getContext?true:false;
d.isTouch="ontouchstart" in document.documentElement;if(!(d.hasCanvas||document.namespaces)){a.fn.mapster=function(){return this;
};return;}if(!i.isBool(a.mapster.defaults.highlight)){d.render_defaults.highlight=!d.isTouch;
}a.extend(d.defaults,d.render_defaults,d.shared_defaults);a.extend(d.area_defaults,d.render_defaults,d.shared_defaults);
if(i.isBool(l)){d.hasCanvas=l;}if(a.browser.msie&&!d.hasCanvas&&!document.namespaces.v){document.namespaces.add("v","urn:schemas-microsoft-com:vml");
k=document.createStyleSheet();j=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];
a.each(j,function(n,m){k.addRule("v\\:"+m,"behavior: url(#default#VML); antialias:true");
});}a(window).bind("load",function(){d.windowLoaded=true;a(d.map_cache).each(function(n,m){if(!m.complete&&m.isReadyToBind()){m.initialize();
}});});};e.test=function(j){return eval(j);};return e;}());a.mapster.impl.init();
}(jQuery));